<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>View Publications - Faculty Publication Tracker</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: url('https://tse2.mm.bing.net/th/id/OIP.tMgSdmB9mFqHWMl5xt0teAHaDt?r=0&cb=thvnextc1&w=626&h=313&rs=1&pid=ImgDetMain') no-repeat center center fixed;
            background-size: cover;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #541f1f;
        }

        .view-container {
            background: rgba(30, 30, 30, 0.6);
            border-radius: 20px;
            padding: 40px 30px;
            width: 100%;
            max-width: 800px;
            text-align: center;
            color: #fff;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: solid transparent;
            animation: glow 3s linear infinite, fadeIn 1.2s ease-in forwards;
            opacity: 0;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        @keyframes glow {
            0% { box-shadow: 0 0 10px #007bff, 0 0 20px #007bff, 0 0 30px #007bff; border-color: #007bff; }
            50% { box-shadow: 0 0 30px #0ef, 0 0 60px #0ef, 0 0 90px #0ef; border-color: #0ef; }
            100% { box-shadow: 0 0 10px #007bff, 0 0 20px #007bff, 0 0 30px #007bff; border-color: #007bff; }
        }

        h2 {
            margin-bottom: 20px;
            font-size: 32px;
            letter-spacing: 1px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        th {
            background: rgba(0, 123, 255, 0.3);
        }

        .message, .error {
            font-weight: bold;
            font-size: 15px;
            margin: 10px 0;
            padding: 10px 0;
            border-radius: 5px;
            color: #fff;
        }

        .message {
            color: #0ef;
        }

        .error {
            color: #ff4d4d;
        }

        a {
            color: #ffeb3b;
            text-decoration: none;
            font-weight: bold;
            margin: 10px;
            display: inline-block;
        }

        a:hover {
            text-decoration: underline;
            color: #fff176;
        }
    </style>
</head>
<body>
    <div class="view-container">
        <h2>Publications</h2>

        <form method="get" style="margin-bottom: 24px; background: rgba(0,0,0,0.2); padding: 18px 20px; border-radius: 10px; display: flex; gap: 18px; justify-content: center; flex-wrap: wrap;">
            <label style="color:#fff;">Faculty:
                <input type="text" name="faculty" value="{{ request.args.get('faculty', '') }}" placeholder="Faculty Name" style="padding:6px; border-radius:5px; border:none;">
            </label>
            <label style="color:#fff;">Type:
                <input type="text" name="type" value="{{ request.args.get('type', '') }}" placeholder="Type (e.g. Book)" style="padding:6px; border-radius:5px; border:none;">
            </label>
            <label style="color:#fff;">Year:
                <input type="text" name="year" value="{{ request.args.get('year', '') }}" placeholder="Year" style="padding:6px; border-radius:5px; border:none;">
            </label>
            <button type="submit" style="background:#0ef; color:#222; font-weight:bold; border:none; border-radius:5px; padding:8px 18px; cursor:pointer;">Filter</button>
            <a href="{{ url_for('view_publications') }}" style="background:#ff4d4d; color:#fff; font-weight:bold; border-radius:5px; padding:8px 18px; text-decoration:none;">Clear</a>
        </form>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div style="margin-bottom:18px;">
                {% for category, message in messages %}
                    <div class="{{ 'message' if category == 'success' else 'error' }}" style="background:rgba(0,0,0,0.3); padding:12px; border-radius:7px; font-size:16px; margin-bottom:8px;">
                        {{ message }}
                    </div>
                {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        {% if records %}
            <table>
                <tr>
                    <th>ID</th>
                    <th>Faculty</th>
                    <th>Department</th>
                    <th>Title</th>
                    <th>Type</th>
                    <th>Publisher</th>
                    <th>Publisher Email</th>
                    <th>Year</th>
                    <th>DOI/Link</th>
                    <th>PDF</th>
                    <th>Created At</th>
                </tr>
                {% for record in records %}
                    <tr>
                        <td>{{ record[0] }}</td>
                        <td>{{ record[1] }}</td>
                        <td>{{ record[2] }}</td>
                        <td>{{ record[3] }}</td>
                        <td>{{ record[4] }}</td>
                        <td>{{ record[5] }}</td>
                        <td>{{ record[6] }}</td>
                        <td>{{ record[7] }}</td>
                        <td>{{ record[8] or 'N/A' }}</td>
                        <td>
                            {% if record[10] %}
                                <a href="{{ url_for('uploaded_file', filename=record[10]) }}" target="_blank">View PDF</a>
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>{{ record[9] | datetimeformat }}</td>
                    </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>No publications found.</p>
        {% endif %}

        <a href="{{ url_for('home') }}">Back to Home</a>
    </div>
</body>
</html>